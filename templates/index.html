<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="100ì±Œë¦°ì§€">
    <meta name="theme-color" content="#3B82F6">
    <meta name="description" content="ë§¤ì¼ 100ê°œ í‘¸ì‹œì—… ì±Œë¦°ì§€ - í•¨ê»˜ ìš´ë™í•˜ê³  ê¸°ë¡í•˜ì„¸ìš”">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/static/icons/icon-192.png">
    <title>One Hundred Push-ups</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --primary: #3B82F6;
            --primary-dark: #2563EB;
            --primary-light: #DBEAFE;
            --success: #10B981;
            --success-light: #D1FAE5;
            --danger: #EF4444;
            --danger-light: #FEE2E2;
            --warning: #F59E0B;
            --gray-50: #F9FAFB;
            --gray-100: #F3F4F6;
            --gray-200: #E5E7EB;
            --gray-300: #D1D5DB;
            --gray-400: #9CA3AF;
            --gray-500: #6B7280;
            --gray-600: #4B5563;
            --gray-700: #374151;
            --gray-800: #1F2937;
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
            --shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04);
            --radius: 16px;
            --radius-lg: 24px;
        }

        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #FFFFFF;
            min-height: 100vh;
            min-height: -webkit-fill-available;
            color: var(--gray-800);
            font-size: 16px;
            line-height: 1.5;
        }

        html {
            height: -webkit-fill-available;
        }

        .container {
            max-width: 480px;
            margin: 0 auto;
            padding: 0 20px;
            padding-bottom: env(safe-area-inset-bottom, 20px);
        }

        /* í—¤ë” */
        .header {
            text-align: center;
            padding: 40px 0 30px;
            background: linear-gradient(180deg, var(--primary-light) 0%, #FFFFFF 100%);
            margin: 0 -20px;
            padding-left: 20px;
            padding-right: 20px;
        }

        .header-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-radius: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 16px;
            box-shadow: var(--shadow-lg);
        }

        .header-icon span {
            font-size: 40px;
        }

        .header h1 {
            font-size: 1.75rem;
            font-weight: 800;
            color: var(--gray-800);
            margin-bottom: 6px;
            letter-spacing: -0.02em;
        }

        .header p {
            color: var(--gray-500);
            font-size: 1rem;
            font-weight: 500;
        }

        /* ë¡œê·¸ì¸ í™”ë©´ */
        .login-screen {
            padding: 20px 0;
        }

        .login-card {
            background: #FFFFFF;
            border-radius: var(--radius-lg);
            padding: 40px 24px;
            box-shadow: var(--shadow-xl);
            border: 1px solid var(--gray-100);
        }

        .login-card h2 {
            text-align: center;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-800);
            margin-bottom: 8px;
        }

        .login-card .subtitle {
            text-align: center;
            color: var(--gray-500);
            margin-bottom: 32px;
            font-size: 0.95rem;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: 8px;
        }

        .input-group input {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius);
            font-size: 1.1rem;
            font-weight: 500;
            transition: all 0.2s;
            background: var(--gray-50);
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--primary);
            background: #FFFFFF;
            box-shadow: 0 0 0 4px var(--primary-light);
        }

        .input-group input::placeholder {
            color: var(--gray-400);
        }

        .btn {
            width: 100%;
            padding: 18px 24px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            border-radius: var(--radius);
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: var(--shadow);
        }

        .btn:active {
            transform: scale(0.98);
            box-shadow: var(--shadow-sm);
        }

        /* ë©”ì¸ í™”ë©´ */
        .main-screen {
            display: none;
            padding-bottom: 40px;
        }

        .main-screen.active {
            display: block;
        }

        /* ìœ ì € ì •ë³´ ë°” */
        .user-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            margin-bottom: 16px;
            border-bottom: 1px solid var(--gray-100);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .user-name {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--gray-800);
        }

        .user-status {
            font-size: 0.85rem;
            color: var(--gray-500);
        }

        .logout-btn {
            background: var(--gray-100);
            color: var(--gray-600);
            border: none;
            padding: 10px 16px;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .logout-btn:active {
            background: var(--gray-200);
        }

        /* ì›” ì„ íƒ */
        .month-select-wrapper {
            margin-bottom: 20px;
        }

        .month-select {
            width: 100%;
            padding: 14px 20px;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius);
            font-size: 1rem;
            font-weight: 600;
            background: #FFFFFF;
            color: var(--gray-700);
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236B7280'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 16px center;
            background-size: 20px;
        }

        /* í†µê³„ ì¹´ë“œ */
        .stats-card {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-radius: var(--radius-lg);
            padding: 28px 24px;
            color: white;
            margin-bottom: 24px;
            box-shadow: var(--shadow-lg);
        }

        .stats-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .stats-label {
            font-size: 0.95rem;
            opacity: 0.9;
            font-weight: 500;
        }

        .stats-amount {
            font-size: 2.5rem;
            font-weight: 800;
            letter-spacing: -0.02em;
        }

        .stats-badge {
            background: rgba(255,255,255,0.2);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.2);
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .stat-label {
            font-size: 0.8rem;
            opacity: 0.8;
            margin-top: 2px;
        }

        /* ì˜¤ëŠ˜ ì²´í¬ ë²„íŠ¼ */
        .today-action {
            background: #FFFFFF;
            border-radius: var(--radius-lg);
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: var(--shadow);
            border: 2px solid var(--gray-100);
        }

        .today-action.completed {
            border-color: var(--success);
            background: var(--success-light);
        }

        .today-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .today-icon {
            width: 48px;
            height: 48px;
            background: var(--primary-light);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .today-action.completed .today-icon {
            background: var(--success);
        }

        .today-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--gray-800);
        }

        .today-date {
            font-size: 0.9rem;
            color: var(--gray-500);
        }

        .today-btn {
            width: 100%;
            padding: 18px;
            border-radius: var(--radius);
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            background: var(--primary);
            color: white;
            box-shadow: var(--shadow);
        }

        .today-btn:active {
            transform: scale(0.98);
        }

        .today-action.completed .today-btn {
            background: var(--success);
        }

        .today-action.not-workday .today-btn {
            background: var(--gray-300);
            cursor: default;
        }

        /* ìº˜ë¦°ë” */
        .calendar-card {
            background: #FFFFFF;
            border-radius: var(--radius-lg);
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: var(--shadow);
            border: 1px solid var(--gray-100);
        }

        .calendar-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--gray-800);
            margin-bottom: 20px;
        }

        .calendar-header {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            margin-bottom: 12px;
        }

        .calendar-header span {
            text-align: center;
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--gray-500);
            padding: 8px 0;
        }

        .calendar-header span:first-child {
            color: var(--danger);
        }

        .calendar-header span:last-child {
            color: var(--primary);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 6px;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s;
            position: relative;
            background: var(--gray-50);
        }

        .calendar-day.empty {
            background: transparent;
            cursor: default;
        }

        .calendar-day.today {
            background: var(--primary-light);
            color: var(--primary-dark);
            font-weight: 700;
            box-shadow: inset 0 0 0 2px var(--primary);
        }

        .calendar-day.completed {
            background: var(--success);
            color: white;
        }

        .calendar-day.completed::after {
            content: '';
            position: absolute;
            bottom: 4px;
            right: 4px;
            width: 8px;
            height: 8px;
            background: white;
            border-radius: 50%;
        }

        .calendar-day.sunday {
            color: var(--danger);
            background: var(--danger-light);
        }

        .calendar-day.saturday {
            color: var(--primary);
            background: var(--primary-light);
        }

        .calendar-day.holiday {
            color: var(--danger);
            background: var(--danger-light);
        }

        .calendar-day.missed {
            background: var(--danger-light);
            color: var(--danger);
        }

        .calendar-day.future {
            color: var(--gray-300);
            background: transparent;
            cursor: default;
        }

        .calendar-day:active:not(.empty):not(.future) {
            transform: scale(0.92);
        }

        /* ë²”ë¡€ */
        .calendar-legend {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--gray-100);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.8rem;
            color: var(--gray-600);
        }

        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 4px;
        }

        .legend-dot.completed { background: var(--success); }
        .legend-dot.missed { background: var(--danger-light); border: 1px solid var(--danger); }
        .legend-dot.holiday { background: var(--danger-light); }

        /* ë­í‚¹ */
        .ranking-card {
            background: #FFFFFF;
            border-radius: var(--radius-lg);
            padding: 24px;
            box-shadow: var(--shadow);
            border: 1px solid var(--gray-100);
        }

        .ranking-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .ranking-header h3 {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--gray-800);
        }

        .ranking-list {
            list-style: none;
        }

        .ranking-item {
            display: flex;
            align-items: center;
            padding: 16px;
            border-radius: var(--radius);
            margin-bottom: 10px;
            background: var(--gray-50);
            transition: all 0.2s;
        }

        .ranking-item:last-child {
            margin-bottom: 0;
        }

        .ranking-item.rank-1 {
            background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%);
        }

        .ranking-item.rank-2 {
            background: linear-gradient(135deg, #F3F4F6 0%, #E5E7EB 100%);
        }

        .ranking-item.rank-3 {
            background: linear-gradient(135deg, #FED7AA 0%, #FDBA74 100%);
        }

        .ranking-item.is-me {
            box-shadow: inset 0 0 0 2px var(--primary);
        }

        .rank-badge {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            border-radius: 10px;
            font-weight: 800;
            font-size: 1rem;
            color: var(--gray-600);
            margin-right: 14px;
            box-shadow: var(--shadow-sm);
        }

        .ranking-item.rank-1 .rank-badge {
            background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);
            color: white;
        }

        .ranking-item.rank-2 .rank-badge {
            background: linear-gradient(135deg, #9CA3AF 0%, #6B7280 100%);
            color: white;
        }

        .ranking-item.rank-3 .rank-badge {
            background: linear-gradient(135deg, #F97316 0%, #EA580C 100%);
            color: white;
        }

        .rank-info {
            flex: 1;
            min-width: 0;
        }

        .rank-name {
            font-weight: 700;
            font-size: 1rem;
            color: var(--gray-800);
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .rank-stats {
            font-size: 0.85rem;
            color: var(--gray-500);
        }

        .rank-penalty {
            text-align: right;
        }

        .penalty-amount {
            font-weight: 800;
            font-size: 1.1rem;
            color: var(--danger);
        }

        .penalty-amount.zero {
            color: var(--success);
        }

        .penalty-label {
            font-size: 0.75rem;
            color: var(--gray-400);
        }

        /* ë”ë³´ê¸°/ì ‘ê¸° ë²„íŠ¼ */
        .ranking-toggle {
            width: 100%;
            padding: 14px;
            margin-top: 12px;
            background: var(--gray-100);
            border: none;
            border-radius: var(--radius);
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--gray-600);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .ranking-toggle:active {
            background: var(--gray-200);
        }

        .ranking-toggle .arrow {
            transition: transform 0.3s;
        }

        .ranking-toggle.expanded .arrow {
            transform: rotate(180deg);
        }

        .ranking-item.hidden {
            display: none;
        }

        /* PWA ì„¤ì¹˜ ë°°ë„ˆ */
        .pwa-banner {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #FFFFFF;
            padding: 20px;
            padding-bottom: calc(20px + env(safe-area-inset-bottom, 0px));
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.15);
            transform: translateY(100%);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1001;
            border-radius: 20px 20px 0 0;
        }

        .pwa-banner.show {
            transform: translateY(0);
        }

        .pwa-banner-content {
            max-width: 480px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .pwa-banner-icon {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .pwa-banner-icon span {
            font-size: 28px;
        }

        .pwa-banner-text {
            flex: 1;
            min-width: 0;
        }

        .pwa-banner-title {
            font-size: 1rem;
            font-weight: 700;
            color: var(--gray-800);
            margin-bottom: 4px;
        }

        .pwa-banner-desc {
            font-size: 0.85rem;
            color: var(--gray-500);
            line-height: 1.4;
        }

        .pwa-banner-actions {
            display: flex;
            flex-direction: column;
            gap: 8px;
            flex-shrink: 0;
        }

        .pwa-install-btn {
            padding: 12px 20px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .pwa-install-btn:active {
            transform: scale(0.96);
        }

        .pwa-dismiss-btn {
            padding: 8px 12px;
            background: transparent;
            color: var(--gray-500);
            border: none;
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            text-align: center;
        }

        /* í† ìŠ¤íŠ¸ */
        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--gray-800);
            color: white;
            padding: 16px 28px;
            border-radius: var(--radius);
            font-size: 1rem;
            font-weight: 600;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s;
            z-index: 1000;
            box-shadow: var(--shadow-xl);
            opacity: 0;
            pointer-events: none;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        /* ë¡œë”© */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
            color: var(--gray-400);
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--gray-200);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-bottom: 16px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ë¹ˆ ìƒíƒœ */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray-400);
        }

        .empty-state p {
            font-size: 0.95rem;
        }

        /* ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }

        /* ìœ ì €ë°” ìš°ì¸¡ ë²„íŠ¼ ê·¸ë£¹ */
        .user-bar-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .admin-btn {
            background: var(--gray-100);
            color: var(--gray-600);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 10px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .admin-btn:active {
            background: var(--gray-200);
        }

        /* ìì‚° ì¹´ë“œ */
        .asset-card {
            background: #FFFFFF;
            border-radius: var(--radius-lg);
            padding: 24px;
            margin-top: 20px;
            box-shadow: var(--shadow);
            border: 1px solid var(--gray-100);
        }

        .asset-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .asset-header-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .asset-header h3 {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--gray-800);
        }

        .asset-refresh-time {
            font-size: 0.75rem;
            color: var(--gray-400);
        }

        .asset-total {
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
            border-radius: var(--radius);
            padding: 20px;
            color: white;
            margin-bottom: 16px;
        }

        .asset-total-label {
            font-size: 0.85rem;
            opacity: 0.9;
            margin-bottom: 4px;
        }

        .asset-total-amount {
            font-size: 1.8rem;
            font-weight: 800;
            letter-spacing: -0.02em;
        }

        .asset-section-title {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--gray-500);
            margin-bottom: 10px;
            margin-top: 16px;
        }

        .stock-list {
            list-style: none;
        }

        .stock-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--gray-100);
        }

        .stock-item:last-child {
            border-bottom: none;
        }

        .stock-symbol {
            font-weight: 700;
            font-size: 1rem;
            color: var(--gray-800);
        }

        .stock-shares {
            font-size: 0.8rem;
            color: var(--gray-500);
        }

        .stock-right {
            text-align: right;
        }

        .stock-value {
            font-weight: 700;
            font-size: 0.95rem;
            color: var(--gray-800);
        }

        .stock-change {
            font-size: 0.8rem;
            font-weight: 600;
        }

        .stock-change.positive {
            color: var(--danger);
        }

        .stock-change.negative {
            color: var(--primary);
        }

        .stock-change.zero {
            color: var(--gray-400);
        }

        .cash-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
        }

        .cash-label {
            font-weight: 600;
            color: var(--gray-600);
        }

        .cash-amount {
            font-weight: 700;
            font-size: 1rem;
            color: var(--gray-800);
        }

        .asset-empty {
            text-align: center;
            padding: 20px;
            color: var(--gray-400);
            font-size: 0.9rem;
        }

        /* ë°”í…€ì‹œíŠ¸ ì˜¤ë²„ë ˆì´ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        /* ë°”í…€ì‹œíŠ¸ */
        .bottom-sheet {
            position: fixed;
            left: 0;
            right: 0;
            bottom: 0;
            background: #FFFFFF;
            border-radius: 20px 20px 0 0;
            z-index: 2001;
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            max-height: 85vh;
            overflow-y: auto;
            padding-bottom: env(safe-area-inset-bottom, 20px);
        }

        .bottom-sheet.show {
            transform: translateY(0);
        }

        .sheet-handle {
            width: 40px;
            height: 4px;
            background: var(--gray-300);
            border-radius: 2px;
            margin: 12px auto;
        }

        .sheet-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 24px 16px;
            border-bottom: 1px solid var(--gray-100);
        }

        .sheet-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--gray-800);
        }

        .sheet-close {
            background: var(--gray-100);
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray-600);
        }

        .sheet-body {
            padding: 20px 24px;
        }

        .sheet-section {
            margin-bottom: 24px;
        }

        .sheet-section-title {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--gray-700);
            margin-bottom: 12px;
        }

        .admin-form {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .admin-form input {
            flex: 1;
            padding: 12px 14px;
            border: 2px solid var(--gray-200);
            border-radius: 10px;
            font-size: 0.95rem;
            font-weight: 500;
            background: var(--gray-50);
        }

        .admin-form input:focus {
            outline: none;
            border-color: var(--primary);
            background: #FFFFFF;
        }

        .admin-form button {
            padding: 12px 18px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 700;
            cursor: pointer;
            white-space: nowrap;
        }

        .admin-stock-list {
            list-style: none;
        }

        .admin-stock-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background: var(--gray-50);
            border-radius: 10px;
            margin-bottom: 8px;
        }

        .admin-stock-info {
            font-weight: 600;
            color: var(--gray-800);
        }

        .admin-stock-actions {
            display: flex;
            gap: 8px;
        }

        .admin-stock-actions button {
            padding: 6px 12px;
            border: none;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
        }

        .btn-edit {
            background: var(--primary-light);
            color: var(--primary-dark);
        }

        .btn-delete {
            background: var(--danger-light);
            color: var(--danger);
        }

        .cash-form {
            display: flex;
            gap: 8px;
        }

        .cash-form input {
            flex: 1;
            padding: 12px 14px;
            border: 2px solid var(--gray-200);
            border-radius: 10px;
            font-size: 0.95rem;
            font-weight: 500;
            background: var(--gray-50);
        }

        .cash-form input:focus {
            outline: none;
            border-color: var(--primary);
            background: #FFFFFF;
        }

        .cash-form button {
            padding: 12px 18px;
            background: var(--success);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 700;
            cursor: pointer;
            white-space: nowrap;
        }

        .admin-hint {
            font-size: 0.8rem;
            color: var(--gray-400);
            margin-top: 6px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-icon">
                <span>ğŸ’ª</span>
            </div>
            <h1>One Hundred Push-ups</h1>
            <p>ë§¤ì¼ 100ê°œ í‘¸ì‹œì—… ì±Œë¦°ì§€</p>
        </div>

        <!-- ë¡œê·¸ì¸ í™”ë©´ -->
        <div class="login-screen" id="loginScreen">
            <div class="login-card fade-in">
                <h2>í™˜ì˜í•©ë‹ˆë‹¤!</h2>
                <p class="subtitle">ì´ë¦„ì„ ì…ë ¥í•˜ê³  ì±Œë¦°ì§€ì— ì°¸ì—¬í•˜ì„¸ìš”</p>
                <div class="input-group">
                    <label for="nameInput">ì´ë¦„</label>
                    <input type="text" id="nameInput" placeholder="í™ê¸¸ë™" autocomplete="off" autocapitalize="off">
                </div>
                <button class="btn" onclick="login()">ì‹œì‘í•˜ê¸°</button>
            </div>
        </div>

        <!-- ë©”ì¸ í™”ë©´ -->
        <div class="main-screen" id="mainScreen">
            <div class="user-bar">
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">í™</div>
                    <div>
                        <div class="user-name" id="userName">í™ê¸¸ë™</div>
                        <div class="user-status">ì±Œë¦°ì§€ ì§„í–‰ì¤‘</div>
                    </div>
                </div>
                <div class="user-bar-actions">
                    <button class="admin-btn" id="adminBtn" onclick="openAdminSheet()" style="display:none;" title="ìì‚° ê´€ë¦¬">&#9881;</button>
                    <button class="logout-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
            </div>

            <div class="month-select-wrapper">
                <select class="month-select" id="monthSelect" onchange="loadCalendar()">
                </select>
            </div>

            <div class="stats-card fade-in">
                <div class="stats-header">
                    <div>
                        <div class="stats-label">ì´ë²ˆ ë‹¬ ë²Œê¸ˆ</div>
                        <div class="stats-amount" id="penaltyAmount">â‚©0</div>
                    </div>
                    <div class="stats-badge" id="completionBadge">0%</div>
                </div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="completedDays">0</div>
                        <div class="stat-label">ì™„ë£Œ</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="missedDays">0</div>
                        <div class="stat-label">ë¯¸ì™„ë£Œ</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="totalWorkdays">0</div>
                        <div class="stat-label">ì´ í‰ì¼</div>
                    </div>
                </div>
            </div>

            <div class="today-action" id="todayAction">
                <div class="today-header">
                    <div class="today-icon" id="todayIcon">ğŸ“…</div>
                    <div>
                        <div class="today-title" id="todayTitle">ì˜¤ëŠ˜ì˜ í‘¸ì‹œì—…</div>
                        <div class="today-date" id="todayDate"></div>
                    </div>
                </div>
                <button class="today-btn" id="todayBtn" onclick="toggleToday()">
                    100ê°œ ì™„ë£Œí•˜ê¸°
                </button>
            </div>

            <div class="calendar-card fade-in">
                <div class="calendar-title">ì´ë²ˆ ë‹¬ ê¸°ë¡</div>
                <div class="calendar-header">
                    <span>ì¼</span>
                    <span>ì›”</span>
                    <span>í™”</span>
                    <span>ìˆ˜</span>
                    <span>ëª©</span>
                    <span>ê¸ˆ</span>
                    <span>í† </span>
                </div>
                <div class="calendar-grid" id="calendarGrid">
                </div>
                <div class="calendar-legend">
                    <div class="legend-item">
                        <div class="legend-dot completed"></div>
                        <span>ì™„ë£Œ</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot missed"></div>
                        <span>ë¯¸ì™„ë£Œ</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot holiday"></div>
                        <span>íœ´ì¼</span>
                    </div>
                </div>
            </div>

            <div class="ranking-card fade-in">
                <div class="ranking-header">
                    <span>ğŸ†</span>
                    <h3>ëª…ì˜ˆì˜ ì „ë‹¹</h3>
                </div>
                <ul class="ranking-list" id="rankingList">
                    <li class="loading">
                        <div class="spinner"></div>
                        <span>ë¡œë”© ì¤‘...</span>
                    </li>
                </ul>
            </div>

            <div class="asset-card fade-in" id="assetCard">
                <div class="asset-header">
                    <div class="asset-header-left">
                        <span>ğŸ’°</span>
                        <h3>ê·¸ë£¹ ë³´ìœ ìì‚°</h3>
                    </div>
                    <span class="asset-refresh-time" id="assetRefreshTime"></span>
                </div>
                <div class="asset-total">
                    <div class="asset-total-label">ì´ ìì‚°</div>
                    <div class="asset-total-amount" id="assetTotalAmount">$0</div>
                </div>
                <div class="asset-section-title">ë³´ìœ  ì£¼ì‹</div>
                <ul class="stock-list" id="stockList">
                    <li class="asset-empty">ë“±ë¡ëœ ì¢…ëª©ì´ ì—†ìŠµë‹ˆë‹¤</li>
                </ul>
                <div class="asset-section-title">ë³´ìœ  í˜„ê¸ˆ</div>
                <div class="cash-row">
                    <span class="cash-label">USD</span>
                    <span class="cash-amount" id="cashAmount">$0</span>
                </div>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <!-- PWA ì„¤ì¹˜ ë°°ë„ˆ -->
    <div class="pwa-banner" id="pwaBanner">
        <div class="pwa-banner-content">
            <div class="pwa-banner-icon">
                <span>ğŸ’ª</span>
            </div>
            <div class="pwa-banner-text">
                <div class="pwa-banner-title">ì•±ìœ¼ë¡œ ì„¤ì¹˜í•˜ê¸°</div>
                <div class="pwa-banner-desc">í™ˆ í™”ë©´ì— ì¶”ê°€í•˜ê³  ë” ë¹ ë¥´ê²Œ ì ‘ì†í•˜ì„¸ìš”</div>
            </div>
            <div class="pwa-banner-actions">
                <button class="pwa-install-btn" id="pwaInstallBtn">ì„¤ì¹˜</button>
                <button class="pwa-dismiss-btn" id="pwaDismissBtn">ë‚˜ì¤‘ì—</button>
            </div>
        </div>
    </div>

    <!-- ê´€ë¦¬ì ë°”í…€ì‹œíŠ¸ -->
    <div class="modal-overlay" id="adminOverlay" onclick="closeAdminSheet()"></div>
    <div class="bottom-sheet" id="adminSheet">
        <div class="sheet-handle"></div>
        <div class="sheet-header">
            <span class="sheet-title">ìì‚° ê´€ë¦¬</span>
            <button class="sheet-close" onclick="closeAdminSheet()">&times;</button>
        </div>
        <div class="sheet-body">
            <div class="sheet-section">
                <div class="sheet-section-title">ì£¼ì‹ ì¶”ê°€</div>
                <div class="admin-form">
                    <input type="text" id="stockSymbolInput" placeholder="ì¢…ëª©ì½”ë“œ (ì˜ˆ: PLTR)" autocapitalize="characters">
                    <input type="number" id="stockSharesInput" placeholder="ìˆ˜ëŸ‰" min="1" style="max-width:100px;">
                    <button onclick="addStock()">ì¶”ê°€</button>
                </div>
                <p class="admin-hint">ë¯¸êµ­ ì£¼ì‹ í‹°ì»¤ ì‹¬ë³¼ ì…ë ¥ (ì˜ˆ: PLTR, AAPL, TSLA, MSFT, NVDA)</p>
            </div>
            <div class="sheet-section">
                <div class="sheet-section-title">ë³´ìœ  ì¢…ëª©</div>
                <ul class="admin-stock-list" id="adminStockList">
                    <li class="asset-empty">ë“±ë¡ëœ ì¢…ëª©ì´ ì—†ìŠµë‹ˆë‹¤</li>
                </ul>
            </div>
            <div class="sheet-section">
                <div class="sheet-section-title">í˜„ê¸ˆ ìì‚° (USD)</div>
                <div class="cash-form">
                    <input type="number" id="cashInput" placeholder="ê¸ˆì•¡ ì…ë ¥" min="0" step="0.01">
                    <button onclick="updateCash()">ì €ì¥</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ìƒíƒœ
        let currentUser = null;
        let currentYear = new Date().getFullYear();
        let currentMonth = new Date().getMonth() + 1;
        let calendarData = null;
        let todayCompleted = false;
        let rankingExpanded = false;
        let deferredPrompt = null;
        let assetRefreshTimer = null;

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            // ì €ì¥ëœ ë¡œê·¸ì¸ ì •ë³´ í™•ì¸ (localStorage - ì˜êµ¬ ì €ì¥)
            const savedUser = localStorage.getItem('pushupUser');
            if (savedUser) {
                try {
                    currentUser = JSON.parse(savedUser);
                    showMainScreen();
                } catch (e) {
                    localStorage.removeItem('pushupUser');
                }
            }

            // ì˜¤ëŠ˜ ë‚ ì§œ í‘œì‹œ
            updateTodayDate();

            // ì—”í„° í‚¤ë¡œ ë¡œê·¸ì¸
            document.getElementById('nameInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') login();
            });
        });

        // ì˜¤ëŠ˜ ë‚ ì§œ ì—…ë°ì´íŠ¸
        function updateTodayDate() {
            const today = new Date();
            const options = { month: 'long', day: 'numeric', weekday: 'long' };
            document.getElementById('todayDate').textContent = today.toLocaleDateString('ko-KR', options);
        }

        // ë¡œê·¸ì¸
        async function login() {
            const nameInput = document.getElementById('nameInput');
            const name = nameInput.value.trim();

            if (!name) {
                showToast('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
                nameInput.focus();
                return;
            }

            try {
                const res = await fetch('/api/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name })
                });

                if (!res.ok) {
                    const error = await res.json();
                    showToast(error.error || 'ë¡œê·¸ì¸ ì‹¤íŒ¨');
                    return;
                }

                currentUser = await res.json();
                // localStorageì— ì €ì¥ (ë¸Œë¼ìš°ì € ì¢…ë£Œ í›„ì—ë„ ìœ ì§€)
                localStorage.setItem('pushupUser', JSON.stringify(currentUser));
                showMainScreen();
                showToast(`${currentUser.name}ë‹˜, í™˜ì˜í•©ë‹ˆë‹¤!`);
            } catch (err) {
                showToast('ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
            }
        }

        // ë¡œê·¸ì•„ì›ƒ
        function logout() {
            localStorage.removeItem('pushupUser');
            currentUser = null;
            document.getElementById('loginScreen').style.display = 'block';
            document.getElementById('mainScreen').classList.remove('active');
            document.getElementById('nameInput').value = '';
        }

        // ë©”ì¸ í™”ë©´ í‘œì‹œ
        async function showMainScreen() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainScreen').classList.add('active');

            // ìœ ì € ì •ë³´ í‘œì‹œ
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userAvatar').textContent = currentUser.name.charAt(0);

            // ê´€ë¦¬ì ë²„íŠ¼ í‘œì‹œ
            document.getElementById('adminBtn').style.display = currentUser.is_admin ? 'flex' : 'none';

            await loadMonthOptions();
            await loadCalendar();
            await loadRanking();
            await loadAssets();

            // 1ë¶„ë§ˆë‹¤ ìì‚° ê°±ì‹ 
            if (assetRefreshTimer) clearInterval(assetRefreshTimer);
            assetRefreshTimer = setInterval(loadAssets, 60000);
        }

        // ì›” ì˜µì…˜ ë¡œë“œ
        async function loadMonthOptions() {
            try {
                const res = await fetch('/api/available-months');
                const months = await res.json();

                const select = document.getElementById('monthSelect');
                select.innerHTML = months.map(m =>
                    `<option value="${m.year}-${m.month}" ${m.year === currentYear && m.month === currentMonth ? 'selected' : ''}>${m.label}</option>`
                ).join('');
            } catch (err) {
                console.error('ì›” ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', err);
            }
        }

        // ìº˜ë¦°ë” ë¡œë“œ
        async function loadCalendar() {
            const [year, month] = document.getElementById('monthSelect').value.split('-').map(Number);
            currentYear = year;
            currentMonth = month;

            try {
                const res = await fetch(`/api/calendar/${year}/${month}?user_id=${currentUser.id}`);
                calendarData = await res.json();

                renderCalendar();
                updateStats();
                updateTodayAction();
                await loadRanking();
            } catch (err) {
                console.error('ìº˜ë¦°ë” ë¡œë“œ ì‹¤íŒ¨:', err);
                showToast('ë°ì´í„° ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
            }
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats() {
            const { penalty, missed_days, total_workdays } = calendarData;
            const completedDays = total_workdays - missed_days;
            const rate = total_workdays > 0 ? Math.round(completedDays / total_workdays * 100) : 0;

            document.getElementById('penaltyAmount').textContent = 'â‚©' + penalty.toLocaleString();
            document.getElementById('completedDays').textContent = completedDays;
            document.getElementById('missedDays').textContent = missed_days;
            document.getElementById('totalWorkdays').textContent = total_workdays;
            document.getElementById('completionBadge').textContent = rate + '%';
        }

        // ì˜¤ëŠ˜ ì•¡ì…˜ ì—…ë°ì´íŠ¸
        function updateTodayAction() {
            const today = new Date();
            const todayStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;

            const isCurrentMonth = currentYear === today.getFullYear() && currentMonth === today.getMonth() + 1;
            const actionEl = document.getElementById('todayAction');
            const btnEl = document.getElementById('todayBtn');
            const iconEl = document.getElementById('todayIcon');
            const titleEl = document.getElementById('todayTitle');

            if (!isCurrentMonth) {
                actionEl.style.display = 'none';
                return;
            }

            actionEl.style.display = 'block';
            todayCompleted = calendarData.completed_dates.includes(todayStr);

            // ì˜¤ëŠ˜ì´ í‰ì¼ì¸ì§€ í™•ì¸
            const dayOfWeek = today.getDay();
            const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;
            const isHoliday = calendarData.holidays.some(h => h.date === todayStr);
            const isWorkday = !isWeekend && !isHoliday;

            actionEl.classList.remove('completed', 'not-workday');

            if (!isWorkday) {
                actionEl.classList.add('not-workday');
                iconEl.textContent = 'ğŸ‰';
                titleEl.textContent = 'ì˜¤ëŠ˜ì€ íœ´ì¼!';
                btnEl.textContent = 'í‘¸ì‰¬ì—… ì•ˆí•´ë„ ë¼ìš”';
                btnEl.disabled = true;
            } else if (todayCompleted) {
                actionEl.classList.add('completed');
                iconEl.textContent = 'âœ…';
                titleEl.textContent = 'ì˜¤ëŠ˜ ì™„ë£Œ!';
                btnEl.textContent = 'ì·¨ì†Œí•˜ê¸°';
                btnEl.disabled = false;
            } else {
                iconEl.textContent = 'ğŸ’ª';
                titleEl.textContent = 'ì˜¤ëŠ˜ì˜ í‘¸ì‹œì—…';
                btnEl.textContent = '100ê°œ ì™„ë£Œí•˜ê¸°';
                btnEl.disabled = false;
            }
        }

        // ì˜¤ëŠ˜ í† ê¸€
        async function toggleToday() {
            const today = new Date();
            const todayStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
            await toggleDay(todayStr);
        }

        // ë‚ ì§œ í† ê¸€ (ê³¼ê±°/ì˜¤ëŠ˜ ëª¨ë‘ ê°€ëŠ¥)
        async function toggleDay(dateStr) {
            try {
                const res = await fetch('/api/toggle', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        user_id: currentUser.id,
                        date: dateStr
                    })
                });

                if (!res.ok) {
                    const error = await res.json();
                    showToast(error.error || 'ì²˜ë¦¬ ì‹¤íŒ¨');
                    return;
                }

                const result = await res.json();

                if (result.completed) {
                    showToast('ğŸ‰ 100ê°œ ì™„ë£Œ! ëŒ€ë‹¨í•´ìš”!');
                } else {
                    showToast('ê¸°ë¡ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤');
                }

                await loadCalendar();
            } catch (err) {
                showToast('ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
            }
        }

        // ìº˜ë¦°ë” ë Œë”ë§
        function renderCalendar() {
            const grid = document.getElementById('calendarGrid');
            const { year, month, completed_dates, holidays, first_day_weekday, last_day } = calendarData;

            const today = new Date();
            const todayStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;

            const holidayDates = holidays.map(h => h.date);
            const startDay = (first_day_weekday + 1) % 7;

            let html = '';

            // ë¹ˆ ì¹¸
            for (let i = 0; i < startDay; i++) {
                html += '<div class="calendar-day empty"></div>';
            }

            // ë‚ ì§œ
            for (let day = 1; day <= last_day; day++) {
                const dateStr = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const dayOfWeek = (startDay + day - 1) % 7;

                const isToday = dateStr === todayStr;
                const isCompleted = completed_dates.includes(dateStr);
                const isHoliday = holidayDates.includes(dateStr);
                const isSunday = dayOfWeek === 0;
                const isSaturday = dayOfWeek === 6;
                const isWeekend = isSunday || isSaturday;

                const dateObj = new Date(year, month - 1, day);
                const isFuture = dateObj > today;
                const isPast = dateObj < new Date(today.getFullYear(), today.getMonth(), today.getDate());
                const isWorkday = !isWeekend && !isHoliday;
                const isMissed = isPast && isWorkday && !isCompleted;

                let classes = ['calendar-day'];
                if (isToday) classes.push('today');
                if (isCompleted) classes.push('completed');
                else if (isHoliday) classes.push('holiday');
                else if (isSunday) classes.push('sunday');
                else if (isSaturday) classes.push('saturday');
                if (isFuture) classes.push('future');
                if (isMissed) classes.push('missed');

                // ë¯¸ë˜ê°€ ì•„ë‹ˆë©´ í´ë¦­ ê°€ëŠ¥
                const clickable = !isFuture ? `onclick="toggleDay('${dateStr}')"` : '';

                html += `<div class="${classes.join(' ')}" ${clickable}>${day}</div>`;
            }

            grid.innerHTML = html;
        }

        // ë­í‚¹ ë¡œë“œ
        async function loadRanking() {
            const list = document.getElementById('rankingList');
            rankingExpanded = false;

            try {
                const res = await fetch(`/api/ranking?year=${currentYear}&month=${currentMonth}`);
                const rankings = await res.json();

                if (rankings.length === 0) {
                    list.innerHTML = '<li class="empty-state"><p>ì•„ì§ ì°¸ê°€ìê°€ ì—†ìŠµë‹ˆë‹¤</p></li>';
                    return;
                }

                const VISIBLE_COUNT = 3;
                const hasMore = rankings.length > VISIBLE_COUNT;

                let html = rankings.map((r, index) => {
                    const isMe = currentUser && r.id === currentUser.id;
                    const rankClass = r.rank <= 3 ? `rank-${r.rank}` : '';
                    const meClass = isMe ? 'is-me' : '';
                    const penaltyClass = r.penalty === 0 ? 'zero' : '';
                    const hiddenClass = index >= VISIBLE_COUNT ? 'hidden' : '';

                    return `
                        <li class="ranking-item ${rankClass} ${meClass} ${hiddenClass}" data-rank-index="${index}">
                            <div class="rank-badge">${r.rank}</div>
                            <div class="rank-info">
                                <div class="rank-name">${r.name}${isMe ? ' (ë‚˜)' : ''}</div>
                                <div class="rank-stats">${r.completed_days}/${r.total_workdays}ì¼ â€¢ ${r.completion_rate}%</div>
                            </div>
                            <div class="rank-penalty">
                                <div class="penalty-amount ${penaltyClass}">â‚©${r.penalty.toLocaleString()}</div>
                                <div class="penalty-label">ë²Œê¸ˆ</div>
                            </div>
                        </li>
                    `;
                }).join('');

                if (hasMore) {
                    html += `
                        <button class="ranking-toggle" id="rankingToggle" onclick="toggleRanking()">
                            <span>ë”ë³´ê¸° (${rankings.length - VISIBLE_COUNT}ëª…)</span>
                            <span class="arrow">â–¼</span>
                        </button>
                    `;
                }

                list.innerHTML = html;
            } catch (err) {
                console.error('ë­í‚¹ ë¡œë“œ ì‹¤íŒ¨:', err);
                list.innerHTML = '<li class="empty-state"><p>ë­í‚¹ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</p></li>';
            }
        }

        // ë­í‚¹ ë”ë³´ê¸°/ì ‘ê¸°
        function toggleRanking() {
            rankingExpanded = !rankingExpanded;
            const items = document.querySelectorAll('.ranking-item[data-rank-index]');
            const toggleBtn = document.getElementById('rankingToggle');
            const VISIBLE_COUNT = 3;

            items.forEach((item, index) => {
                if (index >= VISIBLE_COUNT) {
                    item.classList.toggle('hidden', !rankingExpanded);
                }
            });

            if (toggleBtn) {
                toggleBtn.classList.toggle('expanded', rankingExpanded);
                const count = items.length - VISIBLE_COUNT;
                toggleBtn.innerHTML = rankingExpanded
                    ? '<span>ì ‘ê¸°</span><span class="arrow">â–¼</span>'
                    : `<span>ë”ë³´ê¸° (${count}ëª…)</span><span class="arrow">â–¼</span>`;
            }
        }

        // ìì‚° ë¡œë“œ
        async function loadAssets() {
            try {
                const res = await fetch('/api/assets');
                const data = await res.json();

                // ì´ ìì‚°
                document.getElementById('assetTotalAmount').textContent = '$' + data.total_assets.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});

                // ì£¼ì‹ ëª©ë¡
                const stockList = document.getElementById('stockList');
                if (data.stocks.length === 0) {
                    stockList.innerHTML = '<li class="asset-empty">ë“±ë¡ëœ ì¢…ëª©ì´ ì—†ìŠµë‹ˆë‹¤</li>';
                } else {
                    stockList.innerHTML = data.stocks.map(s => {
                        const changeClass = s.change_percent > 0 ? 'positive' : s.change_percent < 0 ? 'negative' : 'zero';
                        const changeSign = s.change_percent > 0 ? '+' : '';
                        return `
                            <li class="stock-item">
                                <div>
                                    <div class="stock-symbol">${s.symbol}</div>
                                    <div class="stock-shares">${s.shares}ì£¼ Ã— $${s.current_price.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</div>
                                </div>
                                <div class="stock-right">
                                    <div class="stock-value">$${s.value.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</div>
                                    <div class="stock-change ${changeClass}">${changeSign}${s.change_percent}%</div>
                                </div>
                            </li>
                        `;
                    }).join('');
                }

                // í˜„ê¸ˆ
                document.getElementById('cashAmount').textContent = '$' + data.cash.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});

                // ê°±ì‹  ì‹œê°„
                const now = new Date();
                document.getElementById('assetRefreshTime').textContent = now.toLocaleTimeString('ko-KR', {hour: '2-digit', minute: '2-digit'}) + ' ê°±ì‹ ';

                // ê´€ë¦¬ì ëª¨ë‹¬ì˜ ì£¼ì‹ ëª©ë¡ë„ ê°±ì‹ 
                renderAdminStockList(data.stocks);
                // í˜„ê¸ˆ ì…ë ¥ë€ì— í˜„ì¬ê°’ ì„¤ì •
                const cashInput = document.getElementById('cashInput');
                if (cashInput && !cashInput.matches(':focus')) {
                    cashInput.value = data.cash || '';
                }
            } catch (err) {
                console.error('ìì‚° ë¡œë“œ ì‹¤íŒ¨:', err);
            }
        }

        // ê´€ë¦¬ì ëª¨ë‹¬ ì—´ê¸°
        function openAdminSheet() {
            document.getElementById('adminOverlay').classList.add('show');
            document.getElementById('adminSheet').classList.add('show');
            loadAssets();
        }

        // ê´€ë¦¬ì ëª¨ë‹¬ ë‹«ê¸°
        function closeAdminSheet() {
            document.getElementById('adminOverlay').classList.remove('show');
            document.getElementById('adminSheet').classList.remove('show');
        }

        // ê´€ë¦¬ì ì£¼ì‹ ëª©ë¡ ë Œë”ë§
        function renderAdminStockList(stocks) {
            const list = document.getElementById('adminStockList');
            if (!stocks || stocks.length === 0) {
                list.innerHTML = '<li class="asset-empty">ë“±ë¡ëœ ì¢…ëª©ì´ ì—†ìŠµë‹ˆë‹¤</li>';
                return;
            }
            list.innerHTML = stocks.map(s => `
                <li class="admin-stock-item">
                    <div class="admin-stock-info">${s.symbol} - ${s.shares}ì£¼</div>
                    <div class="admin-stock-actions">
                        <button class="btn-edit" onclick="editStock(${s.id}, '${s.symbol}', ${s.shares})">ìˆ˜ì •</button>
                        <button class="btn-delete" onclick="deleteStock(${s.id}, '${s.symbol}')">ì‚­ì œ</button>
                    </div>
                </li>
            `).join('');
        }

        // ì£¼ì‹ ì¶”ê°€
        async function addStock() {
            const symbol = document.getElementById('stockSymbolInput').value.trim().toUpperCase();
            const shares = parseInt(document.getElementById('stockSharesInput').value);

            if (!symbol) { showToast('ì¢…ëª©ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”'); return; }
            if (!shares || shares <= 0) { showToast('ìˆ˜ëŸ‰ì„ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”'); return; }

            try {
                const res = await fetch('/api/admin/stock', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({user_id: currentUser.id, symbol, shares})
                });
                if (!res.ok) {
                    const err = await res.json();
                    showToast(err.error || 'ì¶”ê°€ ì‹¤íŒ¨');
                    return;
                }
                document.getElementById('stockSymbolInput').value = '';
                document.getElementById('stockSharesInput').value = '';
                showToast(`${symbol} ${shares}ì£¼ ì¶”ê°€ ì™„ë£Œ`);
                await loadAssets();
            } catch (err) {
                showToast('ì„œë²„ ì—°ê²° ì‹¤íŒ¨');
            }
        }

        // ì£¼ì‹ ìˆ˜ì •
        async function editStock(id, symbol, currentShares) {
            const newShares = prompt(`${symbol} ìˆ˜ëŸ‰ ë³€ê²½ (í˜„ì¬: ${currentShares}ì£¼)`, currentShares);
            if (newShares === null) return;
            const shares = parseInt(newShares);
            if (!shares || shares <= 0) { showToast('ì˜¬ë°”ë¥¸ ìˆ˜ëŸ‰ì„ ì…ë ¥í•´ì£¼ì„¸ìš”'); return; }

            try {
                const res = await fetch(`/api/admin/stock/${id}`, {
                    method: 'PUT',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({user_id: currentUser.id, shares})
                });
                if (!res.ok) {
                    const err = await res.json();
                    showToast(err.error || 'ìˆ˜ì • ì‹¤íŒ¨');
                    return;
                }
                showToast(`${symbol} ìˆ˜ëŸ‰ ë³€ê²½ ì™„ë£Œ`);
                await loadAssets();
            } catch (err) {
                showToast('ì„œë²„ ì—°ê²° ì‹¤íŒ¨');
            }
        }

        // ì£¼ì‹ ì‚­ì œ
        async function deleteStock(id, symbol) {
            if (!confirm(`${symbol}ì„(ë¥¼) ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;

            try {
                const res = await fetch(`/api/admin/stock/${id}`, {
                    method: 'DELETE',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({user_id: currentUser.id})
                });
                if (!res.ok) {
                    const err = await res.json();
                    showToast(err.error || 'ì‚­ì œ ì‹¤íŒ¨');
                    return;
                }
                showToast(`${symbol} ì‚­ì œ ì™„ë£Œ`);
                await loadAssets();
            } catch (err) {
                showToast('ì„œë²„ ì—°ê²° ì‹¤íŒ¨');
            }
        }

        // í˜„ê¸ˆ ìˆ˜ì •
        async function updateCash() {
            const amount = parseFloat(document.getElementById('cashInput').value);
            if (isNaN(amount) || amount < 0) { showToast('ì˜¬ë°”ë¥¸ ê¸ˆì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”'); return; }

            try {
                const res = await fetch('/api/admin/cash', {
                    method: 'PUT',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({user_id: currentUser.id, amount})
                });
                if (!res.ok) {
                    const err = await res.json();
                    showToast(err.error || 'ì €ì¥ ì‹¤íŒ¨');
                    return;
                }
                showToast('í˜„ê¸ˆ ìì‚° ì €ì¥ ì™„ë£Œ');
                await loadAssets();
            } catch (err) {
                showToast('ì„œë²„ ì—°ê²° ì‹¤íŒ¨');
            }
        }

        // í† ìŠ¤íŠ¸ ë©”ì‹œì§€
        function showToast(message) {
            if (!message) return;
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');

            setTimeout(() => {
                toast.classList.remove('show');
            }, 2500);
        }

        // PWA ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    await navigator.serviceWorker.register('/service-worker.js');
                    console.log('Service Worker ë“±ë¡ ì™„ë£Œ');
                } catch (err) {
                    console.log('Service Worker ë“±ë¡ ì‹¤íŒ¨:', err);
                }
            });
        }

        // PWA ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ ì²˜ë¦¬
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;

            // ì´ì „ì— ë‹«ì€ ì ì´ ìˆìœ¼ë©´ 3ì¼ í›„ì— ë‹¤ì‹œ í‘œì‹œ
            const dismissedAt = localStorage.getItem('pwaDismissedAt');
            if (dismissedAt) {
                const daysSinceDismissed = (Date.now() - parseInt(dismissedAt)) / (1000 * 60 * 60 * 24);
                if (daysSinceDismissed < 3) return;
            }

            // ì´ë¯¸ ì„¤ì¹˜ëœ ê²½ìš° í‘œì‹œí•˜ì§€ ì•ŠìŒ
            if (window.matchMedia('(display-mode: standalone)').matches) return;

            // 1.5ì´ˆ í›„ ë°°ë„ˆ í‘œì‹œ
            setTimeout(() => {
                showPWABanner();
            }, 1500);
        });

        // PWA ë°°ë„ˆ í‘œì‹œ
        function showPWABanner() {
            const banner = document.getElementById('pwaBanner');
            banner.classList.add('show');
        }

        // PWA ë°°ë„ˆ ìˆ¨ê¸°ê¸°
        function hidePWABanner() {
            const banner = document.getElementById('pwaBanner');
            banner.classList.remove('show');
        }

        // PWA ì„¤ì¹˜ ë²„íŠ¼ í´ë¦­
        document.getElementById('pwaInstallBtn').addEventListener('click', async () => {
            if (!deferredPrompt) return;

            hidePWABanner();
            deferredPrompt.prompt();

            const { outcome } = await deferredPrompt.userChoice;
            if (outcome === 'accepted') {
                showToast('ì•±ì´ ì„¤ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰');
            }
            deferredPrompt = null;
        });

        // PWA ë‚˜ì¤‘ì— ë²„íŠ¼ í´ë¦­
        document.getElementById('pwaDismissBtn').addEventListener('click', () => {
            hidePWABanner();
            localStorage.setItem('pwaDismissedAt', Date.now().toString());
        });

        // ì´ë¯¸ ì„¤ì¹˜ëœ ì•±ì—ì„œ ì‹¤í–‰ ì‹œ
        window.addEventListener('appinstalled', () => {
            hidePWABanner();
            deferredPrompt = null;
            showToast('í™ˆ í™”ë©´ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
        });
    </script>
</body>
</html>
